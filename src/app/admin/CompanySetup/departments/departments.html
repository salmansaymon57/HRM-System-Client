<div class="company-setup-container">
  <!-- Header with Logo -->
  <div class="header-logo">
    <div class="logo-container">
      <div class="logo-icon">↑</div>
      <div class="logo-text">
        <span class="softflames">SoftFlames</span>
        <span class="ventures">Ventures</span>
      </div>
    </div>
  </div>

  <div class="main-content">
    <!-- Left Panel: Input Form -->
    <div class="left-panel">
      <div class="panel-header">
        <h2>Department Setup</h2>
      </div>
      <form (ngSubmit)="onSubmit()" #departmentForm="ngForm" class="company-form">

        <!-- Company Name -->
        <div class="p-field">
          <label for="companyName">Company Name</label>
          <p-select id="companyName" [(ngModel)]="departmentData.companyName" name="companyName" [options]="companies"
            optionLabel="name" optionValue="name" placeholder="Select a Company" required class="w-full">
          </p-select>
          
        </div>

         <!-- Branch Name -->
        <div class="p-field">
          <label for="branchName">Branch Name</label>
          <p-select id="branchName" [(ngModel)]="departmentData.branchName" name="branchName" [options]="branches"
            optionLabel="name" optionValue="name" placeholder="Select a Branch" required class="w-full">
          </p-select>
          
        </div>


        <!-- Department Code -->
        <div class="p-field">
          <label for="departmentCode">Department Code</label>
          <input 
            type="number" 
            pInputText 
            id="departmentCode" 
            [(ngModel)]="departmentData.departmentCode"
            name="departmentCode" 
            required 
            class="w-full">
        </div>
        

        <!-- Department Name -->
        <div class="p-field">
          <label for="departmentName">Department Name</label>
          <input 
            type="text" 
            pInputText 
            id="departmentName" 
            [(ngModel)]="departmentData.departmentName" 
            name="departmentName" 
            required 
            class="w-full">
        </div>


        
        

        

        

        <!-- Submit Button Native -->
        <div class="p-field">
          <button type="submit" [disabled]="!departmentForm.valid || isSubmitting || isSuccess" class="submit-btn w-full">
            <span *ngIf="isSuccess && !isSubmitting" class="pi pi-check"></span>
            <span *ngIf="isSubmitting" class="pi pi-spinner pi-spin"></span>
            {{ isSubmitting ? 'Submitting...' : (isSuccess ? 'Submitted!' : 'Submit') }}
          </button>
        </div>
      </form>
    </div>

    <!-- Right Panel: Department List Grid -->
    <div class="right-panel">
      <div class="panel-header">
        <h2>Department List</h2>
      </div>
      <div class="table-header">
        <span class="p-input-icon-left">
          <!-- <i class="pi pi-search"></i> -->
          <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')"
            placeholder="Search..." />
        </span>
      </div>
      <p-table 
        #dt
        [value]="departments" 
        [paginator]="true" 
        [rows]="10" 
        [rowsPerPageOptions]="[5,10,25]" 
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
        [tableStyle]="{ 'min-width': '50rem' }"
        styleClass="p-datatable-sm"
        [globalFilterFields]="['departmentCode','departmentName','companyName','branchName']">
        

        <ng-template pTemplate="header">
          <tr>
            <th>SL</th>
            <th pSortableColumn="departmentCode">Department Code</th>
            <th pSortableColumn="departmentName">Department Name</th>
            <th pSortableColumn="companyName">Company Name</th>
            <th pSortableColumn="branchName">Branch Name</th>
            <th>Started Date</th>
            <th>Locked Date</th>
            <th>Edited By</th>
            <th>Action</th>
          </tr>
        </ng-template>
        
        <ng-template pTemplate="body" let-department let-rowIndex="rowIndex">
          <tr>
            <td>{{ getRowNumber(rowIndex) }}</td>
            <td>{{ department.departmentCode }}</td>
            <td>{{ department.departmentName }}</td>
            <td>{{ department.companyName }}</td>
            <td>{{ department.branchName }}</td>
            <td>{{ formatDate(department.startDate) }}</td>
            <td>{{ formatDate(department.lockedDate) || '—' }}</td>
            <td>{{ department.editedBy || '—' }}</td>
            <td>
              <div class="action-buttons">
                <button 
                  pButton 
                  type="button" 
                  icon="pi pi-pencil" 
                  class="p-button-rounded p-button-text p-button-secondary" 
                  (click)="editDepartment(department)">
                </button>
                <button 
                  pButton 
                  type="button" 
                  icon="pi pi-check" 
                  class="p-button-rounded p-button-text p-button-success" 
                  (click)="approveDepartment(department)">
                </button>
                <button 
                  pButton 
                  type="button" 
                  icon="pi pi-lock" 
                  class="p-button-rounded p-button-text p-button-warning" 
                  (click)="lockDepartment(department)">
                </button>
                <button 
                  pButton 
                  type="button" 
                  icon="pi pi-trash" 
                  class="p-button-rounded p-button-text p-button-danger" 
                  (click)="deleteDepartment(department.id)">
                </button>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="9">No departments found.</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>